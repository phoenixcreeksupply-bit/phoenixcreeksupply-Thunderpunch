name: Validate JSON

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate-json:
    name: Validate tracked JSON files
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate JSON files
        # Use a small inline Node script to parse all tracked .json files
        run: |
          set -e
          echo "Listing tracked JSON files (excluding node_modules and .next)..."
          files=$(git ls-files '*.json' ':!:node_modules/*' ':!.next/*' ':!.vercel/*' || true)
          if [ -z "$files" ]; then
            echo "No JSON files found to validate."
            exit 0
          fi
          echo "$files" | tr ' ' '\n' | while read f; do
            echo "Checking $f"
            node -e "const fs=require('fs'); const p=process.argv[1]; try{ JSON.parse(fs.readFileSync(p,'utf8')); console.log('OK',p);}catch(e){ console.error('INVALID JSON in',p); console.error(e.message); process.exit(2);}" "$f"
          done

      - name: Done
        run: echo "JSON validation complete"
